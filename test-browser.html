<!DOCTYPE html>
<html>
<head>
    <title>Terminal Connection Test</title>
</head>
<body>
    <h1>Testing Terminal Connection</h1>
    <div id="output"></div>

    <script>
        const output = document.getElementById('output');

        function log(message) {
            output.innerHTML += message + '<br>';
            console.log(message);
        }

        log('üöÄ Starting WebSocket test...');

        const ws = new WebSocket('ws://localhost:8080/ws');

        ws.onopen = function() {
            log('‚úÖ WebSocket connected');

            // Request container list
            const msg = {
                type: 'container_list',
                payload: {}
            };

            log('üì® Requesting container list...');
            ws.send(JSON.stringify(msg));
        };

        ws.onmessage = function(event) {
            try {
                const msg = JSON.parse(event.data);
                log(`üì® Received: ${msg.type} - ${JSON.stringify(msg.payload).substring(0, 100)}`);

                if (msg.type === 'container_list') {
                    const containers = msg.payload;
                    const running = containers.filter(c => c.status === 'running');
                    log(`üì¶ Found ${containers.length} containers, ${running.length} running`);

                    if (running.length > 0) {
                        // Test container selection
                        setTimeout(() => {
                            const selectMsg = {
                                type: 'container_select',
                                payload: {
                                    container_name: running[0].name
                                }
                            };
                            log(`üöÄ Selecting container: ${running[0].name}`);
                            ws.send(JSON.stringify(selectMsg));
                        }, 1000);
                    }
                }

                if (msg.type === 'status' && msg.payload.message && msg.payload.message.includes('Terminal session started')) {
                    log('‚úÖ TERMINAL SESSION STARTED!');

                    // Test terminal input
                    setTimeout(() => {
                        const input = {
                            type: 'terminal_input',
                            payload: {
                                pane_id: 'main',
                                data: 'echo "Test successful"\n'
                            }
                        };
                        log('‚å®Ô∏è  Sending test command...');
                        ws.send(JSON.stringify(input));
                    }, 1000);
                }

                if (msg.type === 'terminal_output') {
                    log(`üñ•Ô∏è  Terminal: ${msg.payload.data.trim()}`);
                }

            } catch (e) {
                log(`‚ùå Error: ${e.message}`);
            }
        };

        ws.onerror = function(error) {
            log(`‚ùå WebSocket error: ${error}`);
        };

        ws.onclose = function() {
            log('üîå WebSocket closed');
        };
    </script>
</body>
</html>